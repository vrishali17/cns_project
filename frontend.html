<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Image Encryption</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #00186a;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #c084fc;
            font-size: 0.9rem;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        select, button, input[type="file"] {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #eab308 0%, #f97316 100%);
        }
        
        .btn-upload {
            background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
        }
        
        .btn-encrypt {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }
        
        .btn-decrypt {
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .status-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #86efac;
        }
        
        .images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .image-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
        }
        
        .image-box h3 {
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .image-container {
            width: 100%;
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .placeholder {
            color: #c084fc;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid;
        }
        
        .metric-card p:first-child {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .metric-card p:last-child {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .metric-yellow {
            background: rgba(234, 179, 8, 0.2);
            border-color: rgba(234, 179, 8, 0.5);
            color: #fef08a;
        }
        
        .metric-purple {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.5);
            color: #e9d5ff;
        }
        
        .metric-green {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
            color: #86efac;
        }
        
        .metric-blue {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            color: #93c5fd;
        }
        
        .log {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
        }
        
        .log h2 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .log-content {
            max-height: 150px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .log-info {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }
        
        .log-success {
            background: rgba(16, 185, 129, 0.2);
            color: #86efac;
        }
        
        .log-error {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí RSA Image Encryption & Decryption</h1>
            <p>Pure Manual Implementation (Sch√∂nhage-Strassen Technique)</p>
        </div>

        <div class="controls">
            <div class="card">
                <h2>üîë Key Generation</h2>
                <select id="keySize">
                    <option value="256">256 bits (Fast)</option>
                    <option value="512" selected>512 bits (Balanced)</option>
                    <option value="1024">1024 bits (Secure)</option>
                </select>
                <button class="btn-generate" onclick="generateKeys()">‚ö° Generate Keys</button>
                <div id="keyStatus" class="status status-success hidden">‚úì Keys Generated</div>
            </div>

            <div class="card">
                <h2>üì∑ Upload Image</h2>
                <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                <div id="uploadStatus" class="status status-success hidden">‚úì Image Loaded</div>
            </div>

            <div class="card">
                <h2>üîê Operations</h2>
                <button class="btn-encrypt" onclick="encryptImage()">üîí Encrypt Image</button>
                <button class="btn-decrypt" onclick="decryptImage()">üîì Decrypt Image</button>
            </div>
        </div>

        <div class="images">
            <div class="image-box">
                <h3>Original Image</h3>
                <div class="image-container">
                    <img id="originalImg" class="hidden">
                    <p class="placeholder" id="originalPlaceholder">No image uploaded</p>
                </div>
            </div>

            <div class="image-box">
                <h3>Encrypted Image</h3>
                <div class="image-container">
                    <img id="encryptedImg" class="hidden">
                    <p class="placeholder" id="encryptedPlaceholder">Encrypted noise will appear here</p>
                </div>
            </div>

            <div class="image-box">
                <h3>Decrypted Image</h3>
                <div class="image-container">
                    <img id="decryptedImg" class="hidden">
                    <p class="placeholder" id="decryptedPlaceholder">Decrypted result will appear here</p>
                </div>
            </div>
        </div>

        <div id="metricsSection" class="metrics hidden"></div>

        <div class="log">
            <h2>üìã Activity Log</h2>
            <div class="log-content" id="logContent">
                <div class="log-entry log-info">Ready. Start by generating keys.</div>
            </div>
        </div>
    </div>

    <script>
        var imageData = null;
        var publicKey = null;
        var privateKey = null;
        var encryptedData = null;
        var metrics = {};

        function addLog(msg, type) {
            if (!type) type = 'info';
            var log = document.getElementById('logContent');
            var time = new Date().toLocaleTimeString();
            var entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;
            entry.textContent = '[' + time + '] ' + msg;
            log.insertBefore(entry, log.firstChild);
        }

        var BigNum = {
            mul: function(a, b) {
                if (a < 1000n || b < 1000n) return a * b;
                
                var aStr = a.toString();
                var bStr = b.toString();
                var n = Math.max(aStr.length, bStr.length);
                var half = Math.floor(n / 2);
                
                var divisor = 10n ** BigInt(half);
                var high1 = a / divisor;
                var low1 = a % divisor;
                var high2 = b / divisor;
                var low2 = b % divisor;
                
                var z0 = this.mul(low1, low2);
                var z1 = this.mul(low1 + high1, low2 + high2);
                var z2 = this.mul(high1, high2);
                
                return z2 * (10n ** BigInt(2 * half)) + (z1 - z2 - z0) * divisor + z0;
            },

            mod: function(a, m) {
                var result = a % m;
                return result < 0n ? result + m : result;
            },

            modPow: function(base, exp, mod) {
                if (mod === 1n) return 0n;
                var result = 1n;
                base = this.mod(base, mod);
                
                while (exp > 0n) {
                    if (exp % 2n === 1n) {
                        result = this.mod(this.mul(result, base), mod);
                    }
                    exp = exp / 2n;
                    base = this.mod(this.mul(base, base), mod);
                }
                return result;
            },

            gcd: function(a, b) {
                while (b !== 0n) {
                    var temp = b;
                    b = this.mod(a, b);
                    a = temp;
                }
                return a;
            },

            modInv: function(a, m) {
                var old_r = a;
                var r = m;
                var old_s = 1n;
                var s = 0n;

                while (r !== 0n) {
                    var q = old_r / r;
                    var temp_r = r;
                    r = old_r - q * r;
                    old_r = temp_r;
                    
                    var temp_s = s;
                    s = old_s - q * s;
                    old_s = temp_s;
                }

                return old_s < 0n ? old_s + m : old_s;
            },

            isPrime: function(n, rounds) {
                if (!rounds) rounds = 5;
                if (n < 2n) return false;
                if (n === 2n || n === 3n) return true;
                if (n % 2n === 0n) return false;

                var d = n - 1n;
                var r = 0n;
                while (d % 2n === 0n) {
                    d = d / 2n;
                    r = r + 1n;
                }

                for (var i = 0; i < rounds; i++) {
                    var a = BigInt(Math.floor(Math.random() * Number(n - 4n))) + 2n;
                    var x = this.modPow(a, d, n);

                    if (x === 1n || x === n - 1n) continue;

                    var continueOuter = false;
                    for (var j = 0n; j < r - 1n; j = j + 1n) {
                        x = this.modPow(x, 2n, n);
                        if (x === n - 1n) {
                            continueOuter = true;
                            break;
                        }
                    }
                    if (continueOuter) continue;
                    return false;
                }
                return true;
            },

            genPrime: function(bits) {
                while (true) {
                    var num = 0n;
                    for (var i = 0; i < bits; i++) {
                        if (Math.random() > 0.5) {
                            num = num | (1n << BigInt(i));
                        }
                    }
                    num = num | (1n << BigInt(bits - 1)) | 1n;
                    
                    if (this.isPrime(num)) return num;
                }
            }
        };

        function generateKeys() {
            var keySize = parseInt(document.getElementById('keySize').value);
            addLog('Generating ' + keySize + '-bit RSA keys...', 'info');
            
            setTimeout(function() {
                var start = performance.now();
                
                var p = BigNum.genPrime(keySize / 2);
                var q = BigNum.genPrime(keySize / 2);
                var n = BigNum.mul(p, q);
                var phi = BigNum.mul(p - 1n, q - 1n);
                
                var e = 65537n;
                while (BigNum.gcd(e, phi) !== 1n) e = e + 2n;
                
                var d = BigNum.modInv(e, phi);
                
                publicKey = { e: e, n: n };
                privateKey = { d: d, n: n };
                
                var time = performance.now() - start;
                metrics.keyGenTime = time;
                
                document.getElementById('keyStatus').classList.remove('hidden');
                addLog('Keys generated in ' + time.toFixed(0) + 'ms', 'success');
                updateMetrics();
            }, 100);
        }

        function handleImageUpload(event) {
            var file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = new Image();
                    img.onload = function() {
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        
                        var maxSize = 80;
                        var scale = Math.min(maxSize / img.width, maxSize / img.height);
                        canvas.width = Math.floor(img.width * scale);
                        canvas.height = Math.floor(img.height * scale);
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        
                        var originalImg = document.getElementById('originalImg');
                        originalImg.src = e.target.result;
                        originalImg.classList.remove('hidden');
                        document.getElementById('originalPlaceholder').style.display = 'none';
                        
                        document.getElementById('uploadStatus').classList.remove('hidden');
                        addLog('Image loaded: ' + canvas.width + 'x' + canvas.height + 'px', 'success');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function encryptImage() {
            if (!imageData || !publicKey) {
                addLog('Upload image and generate keys first!', 'error');
                return;
            }

            addLog('Encrypting with pure RSA...', 'info');
            
            setTimeout(function() {
                var start = performance.now();
                var keySize = parseInt(document.getElementById('keySize').value);
                var pixels = imageData.data;
                var encrypted = [];
                var blockSize = Math.floor((keySize - 11) / 8);
                
                for (var i = 0; i < pixels.length; i += blockSize) {
                    var block = pixels.slice(i, i + blockSize);
                    var blockVal = 0n;
                    
                    for (var j = 0; j < block.length; j++) {
                        blockVal = (blockVal << 8n) + BigInt(block[j]);
                    }
                    
                    var enc = BigNum.modPow(blockVal, publicKey.e, publicKey.n);
                    encrypted.push({ value: enc, length: block.length });
                }
                
                var canvas = document.createElement('canvas');
                canvas.width = imageData.width;
                canvas.height = imageData.height;
                var ctx = canvas.getContext('2d');
                var encImgData = ctx.createImageData(canvas.width, canvas.height);
                
                for (var i = 0; i < encrypted.length; i++) {
                    var startIdx = i * blockSize;
                    for (var j = 0; j < encrypted[i].length && startIdx + j < encImgData.data.length; j++) {
                        var noise = Number((encrypted[i].value >> BigInt(j * 13 % 64)) & 0xFFn);
                        encImgData.data[startIdx + j] = noise;
                    }
                }
                
                ctx.putImageData(encImgData, 0, 0);
                
                var encryptedImg = document.getElementById('encryptedImg');
                encryptedImg.src = canvas.toDataURL();
                encryptedImg.classList.remove('hidden');
                document.getElementById('encryptedPlaceholder').style.display = 'none';
                
                encryptedData = { blocks: encrypted, width: imageData.width, height: imageData.height };
                
                var time = performance.now() - start;
                metrics.encryptTime = time;
                metrics.blocks = encrypted.length;
                
                addLog('Encrypted ' + encrypted.length + ' blocks in ' + time.toFixed(0) + 'ms', 'success');
                updateMetrics();
            }, 100);
        }

        function decryptImage() {
            if (!encryptedData || !privateKey) {
                addLog('Encrypt an image first!', 'error');
                return;
            }

            addLog('Decrypting with pure RSA...', 'info');
            
            setTimeout(function() {
                var start = performance.now();
                var decrypted = [];
                
                for (var i = 0; i < encryptedData.blocks.length; i++) {
                    var block = encryptedData.blocks[i];
                    var dec = BigNum.modPow(block.value, privateKey.d, privateKey.n);
                    
                    for (var j = block.length - 1; j >= 0; j--) {
                        var byte = Number((dec >> BigInt(j * 8)) & 0xFFn);
                        decrypted.push(byte);
                    }
                }
                
                var canvas = document.createElement('canvas');
                canvas.width = encryptedData.width;
                canvas.height = encryptedData.height;
                var ctx = canvas.getContext('2d');
                var imgData = ctx.createImageData(canvas.width, canvas.height);
                
                for (var i = 0; i < Math.min(decrypted.length, imgData.data.length); i++) {
                    imgData.data[i] = decrypted[i] || 0;
                }
                
                ctx.putImageData(imgData, 0, 0);
                
                var decryptedImg = document.getElementById('decryptedImg');
                decryptedImg.src = canvas.toDataURL();
                decryptedImg.classList.remove('hidden');
                document.getElementById('decryptedPlaceholder').style.display = 'none';
                
                var time = performance.now() - start;
                metrics.decryptTime = time;
                
                addLog('Decrypted in ' + time.toFixed(0) + 'ms', 'success');
                updateMetrics();
            }, 100);
        }

        function updateMetrics() {
            var section = document.getElementById('metricsSection');
            if (Object.keys(metrics).length === 0) return;
            
            section.classList.remove('hidden');
            section.innerHTML = '';
            
            if (metrics.keyGenTime) {
                section.innerHTML += '<div class="metric-card metric-yellow"><p>Key Generation</p><p>' + metrics.keyGenTime.toFixed(0) + 'ms</p></div>';
            }
            
            if (metrics.encryptTime) {
                section.innerHTML += '<div class="metric-card metric-purple"><p>Encryption Time</p><p>' + metrics.encryptTime.toFixed(0) + 'ms</p></div>';
            }
            
            if (metrics.decryptTime) {
                section.innerHTML += '<div class="metric-card metric-green"><p>Decryption Time</p><p>' + metrics.decryptTime.toFixed(0) + 'ms</p></div>';
            }
            
            if (metrics.blocks) {
                section.innerHTML += '<div class="metric-card metric-blue"><p>Blocks Processed</p><p>' + metrics.blocks + '</p></div>';
            }
        }
    </script>
</body>
</html>